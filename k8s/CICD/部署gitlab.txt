1.docker安装gitlab
docker run -d \
  -h gitlab.lsm1998.com \
  -p 443:443 -p 80:80 -p 222:22 \
  --name gitlab \
  --restart always \
  -v /srv/gitlab/config:/etc/gitlab \
  -v /srv/gitlab/logs:/var/log/gitlab \
  -v /srv/gitlab/data:/var/opt/gitlab \
  gitlab/gitlab-ce:latest

HTTPS方式部署

mkdir /srv/gitlab/config/ssl  放入证书

sudo vi /srv/gitlab/config/gitlab.rb

nginx['listen_port'] = 443 #如果在上面的url中写入了端口，则gitlab在配置nginx时会自动设置此值
gitlab_rails['gitlab_shell_ssh_port'] = 222 #如果自定义了ssh端口，在这设置以后就能在ssh clone地址处正确显示
letsencrypt['enable'] = false #不需要letsencrypt自动签名
nginx['ssl_certificate'] = "/etc/gitlab/ssl/gitlab.lsm1998.com.crt" #记得修改your.crt至你存放在ssl目录下的crt文件名
nginx['ssl_certificate_key'] = "/etc/gitlab/ssl/gitlab.lsm1998.com.key" #记得修改your.key至你存放在ssl目录下的crt文件名
external_url "https://gitlab.lsm1998.com" #监听的端口号。注意！需要写https！
nginx['redirect_http_to_https'] = true


docker exec -it gitlab bash 进入gitlab容器
gitlab-ctl reconfigure 让gitbal重新读取配置
gitlab-ctl hup nginx nginx更新配置